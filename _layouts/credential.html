---
layout: default
---

{% assign credential_json = site.data.credentials[page.credential_data] %}

<!-- pretty-print-json (tiny syntax highlighter for JSON) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretty-print-json@1.2.0/dist/pretty-print-json.min.css">
<script src="https://cdn.jsdelivr.net/npm/pretty-print-json@1.2.0/dist/pretty-print-json.min.js"></script>

<!-- QR Code library -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<!-- Offers functionality -->
<script src="{{ '/assets/offers.js' | relative_url }}"></script>



<div class="credential-page">
  <main class="credential-main">
    <h1>{{ page.title }}</h1>

    {{ page.content }}

    <div id="json-content"></div>
  </main>

  <aside class="credential-aside" aria-label="Actions">
    <strong>Actions</strong>
    <ul class="credential-actions">
      <li>
        <a href="#" id="download-json" class="button" download="{{ page.slug }}.json">ðŸ“¥ Download JSON</a>
      </li>
      <li>
        <a href="#" id="copy-json" class="button">ðŸ“‹ Copy JSON</a>
      </li>
      <li>
        <a href="#" id="import-wallet-button" class="button">ðŸ“² Import in Wallet</a>
      </li>
    </ul>
    <div id="offer-container" style="display: none;"></div>
  </aside>
</div>

<!-- embed compact JSON in a script tag to avoid quoting/escaping issues -->
<script type="application/json" id="json-data">
{{ credential_json | jsonify }}
</script>

<script>
(function() {
  try {
    const rawJsonEl = document.getElementById('json-data');
    const raw = JSON.parse(rawJsonEl.textContent || '{}');

    // Pretty HTML with syntax highlighting
    const html = prettyPrintJson.toHtml(raw, { indent: 4, lineNumbers: true  });
    const container = document.getElementById('json-content');
    container.innerHTML = html;

    // Setup download link (prettified)
    const pretty = JSON.stringify(raw, null, 2);
    const downloadLink = document.getElementById('download-json');
    const blob = new Blob([pretty], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    downloadLink.href = url;

    // Setup copy to clipboard
    const copyButton = document.getElementById('copy-json');
    copyButton.addEventListener('click', () => {
      navigator.clipboard.writeText(pretty).then(() => {
        copyButton.textContent = 'âœ… Copied!';
        setTimeout(() => {
          copyButton.textContent = 'ðŸ“‹ Copy JSON';
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy JSON', err);
      });
    });

    // Initialize offer button functionality
    initializeOfferButton(raw);
  } catch (err) {
    console.error('Failed to render JSON', err);
    const container = document.getElementById('json-content');
    if (container) container.textContent = 'Error rendering JSON.';
  }
})();
</script>
