---
layout: default
---

{% assign credential_json = site.data.credentials[page.credential_data] %}

<!-- pretty-print-json (tiny syntax highlighter for JSON) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretty-print-json@1.2.0/dist/pretty-print-json.min.css">
<script src="https://cdn.jsdelivr.net/npm/pretty-print-json@1.2.0/dist/pretty-print-json.min.js"></script>

<!-- QR Code library -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<!-- Offers functionality -->
<script src="{{ '/assets/offers.js' | relative_url }}"></script>

<style>
/* Two-column layout: main content + aside actions */
.credential-page {
  display: grid;
  grid-template-columns: 600px 500px;
  gap: 2rem;
  align-items: start;
  max-width: 1200px;
  margin: 0 auto;
}
.credential-main {
  max-width: none;
}
.credential-aside {
  background: #fafafa;
  border-radius: 6px;
  padding: 1rem;
  box-shadow: 0 0 0 1px rgba(0,0,0,0.02);
}
ul.credential-actions {
  margin-top:.5rem;
  list-style: none;
  padding: 0;
}
.credential-actions li {
  margin-bottom: 0.5rem;
}
.credential-actions a.button {
  display: inline-block;
  background: #0077cc;
  color: #fff;
  padding: 0.5rem 0.8rem;
  border-radius: 4px;
  text-decoration: none;
}
@media (max-width: 1240px) {
  .credential-page { 
    grid-template-columns: 1fr;
    max-width: 100%;
  }
  .credential-aside { order: 2; }
}
</style>

<div class="credential-page">
  <main class="credential-main">
    <h1>{{ page.title }}</h1>

    {{ page.content }}

    <div id="json-content" style="margin-top:1.5rem;"></div>
  </main>

  <aside class="credential-aside" aria-label="Actions">
    <strong>Actions</strong>
    <ul class="credential-actions">
      <li>
        <a href="#" id="download-json" class="button" download="{{ page.slug }}.json">ðŸ“¥ Download JSON</a>
      </li>
      <li>
        <a href="#" id="copy-json" class="button">ðŸ“‹ Copy JSON</a>
      </li>
      <li>
        <a href="#" id="import-wallet-button" class="button">ðŸ“² Import in Wallet</a>
      </li>
    </ul>
    <div id="offer-container" style="display: none;"></div>
  </aside>
</div>

<!-- embed compact JSON in a script tag to avoid quoting/escaping issues -->
<script type="application/json" id="json-data">
{{ credential_json | jsonify }}
</script>

<script>
(function() {
  try {
    const rawJsonEl = document.getElementById('json-data');
    const raw = JSON.parse(rawJsonEl.textContent || '{}');

    // Pretty HTML with syntax highlighting
    const html = prettyPrintJson.toHtml(raw, { indent: 4, lineNumbers: true  });
    const container = document.getElementById('json-content');
    container.innerHTML = html;

    // Setup download link (prettified)
    const pretty = JSON.stringify(raw, null, 2);
    const downloadLink = document.getElementById('download-json');
    const blob = new Blob([pretty], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    downloadLink.href = url;

    // Setup copy to clipboard
    const copyButton = document.getElementById('copy-json');
    copyButton.addEventListener('click', () => {
      navigator.clipboard.writeText(pretty).then(() => {
        copyButton.textContent = 'âœ… Copied!';
        setTimeout(() => {
          copyButton.textContent = 'ðŸ“‹ Copy JSON';
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy JSON', err);
      });
    });

    // Initialize offer button functionality
    initializeOfferButton(raw);
  } catch (err) {
    console.error('Failed to render JSON', err);
    const container = document.getElementById('json-content');
    if (container) container.textContent = 'Error rendering JSON.';
  }
})();
</script>
</text>
